<!DOCTYPE html>
<html class="writer-html5" lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>etl_functions &mdash; documentación de Proyecto itc_etl - 1.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Proyecto itc_etl
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Módulos</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Proyecto itc_etl</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Código de módulo</a></li>
      <li class="breadcrumb-item active">etl_functions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Código fuente para etl_functions</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>



<div class="viewcode-block" id="rows_tolist"><a class="viewcode-back" href="../modules.html#etl_functions.rows_tolist">[documentos]</a><span class="k">def</span> <span class="nf">rows_tolist</span><span class="p">(</span><span class="n">datos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convierte un DataFrame en una lista de listas, donde cada sublista representa una fila del DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        datos (DataFrame): El DataFrame que se desea convertir.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Una lista de listas, donde cada sublista representa una fila del DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lista_filas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Itera sobre cada fila del DataFrame y agrega la fila a la lista</span>
    <span class="k">for</span> <span class="n">indice</span><span class="p">,</span> <span class="n">fila</span> <span class="ow">in</span> <span class="n">datos</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">lista_filas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fila</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">lista_filas</span></div>


<div class="viewcode-block" id="info_death"><a class="viewcode-back" href="../modules.html#etl_functions.info_death">[documentos]</a><span class="k">def</span> <span class="nf">info_death</span><span class="p">(</span><span class="n">records</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtiene información sobre las muertes, incluyendo la fecha de defunción y la causa de la muerte.</span>

<span class="sd">    Args:</span>
<span class="sd">        recor (list): Una lista de registros que contienen información sobre defunciones.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Una lista de tuplas, donde cada tupla contiene la fecha de defunción y la causa de la muerte.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deathillnes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">death</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">necropsy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
        <span class="n">deathillnes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rec</span><span class="o">.</span><span class="n">dod</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">cod</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">death</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">dod</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">autopsy</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">necropsy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">dod</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">death</span><span class="p">,</span> <span class="n">necropsy</span><span class="p">,</span> <span class="n">deathillnes</span></div>


<div class="viewcode-block" id="info_disease"><a class="viewcode-back" href="../modules.html#etl_functions.info_disease">[documentos]</a><span class="k">def</span> <span class="nf">info_disease</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtiene información sobre enfermedades, incluyendo la fecha de diagnóstico y la patología asociada.</span>

<span class="sd">    Args:</span>
<span class="sd">        record (list): Una lista de registros que contienen información sobre enfermedades.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Una tupla de tres listas, donde la primera lista contiene información sobre enfermedades confirmadas,</span>
<span class="sd">               la segunda lista contiene información sobre enfermedades sospechosas y la tercera lista contiene</span>
<span class="sd">               información sobre enfermedades recuperadas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">confir</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">suspe</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">reco</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">record</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">lab_confirmed</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">healed_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">confir</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rec</span><span class="o">.</span><span class="n">diagnosed_date</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">pathology</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">lab_confirmed</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">healed_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">suspe</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rec</span><span class="o">.</span><span class="n">diagnosed_date</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">pathology</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">rec</span><span class="o">.</span><span class="n">lab_confirmed</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">healed_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reco</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rec</span><span class="o">.</span><span class="n">healed_date</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">pathology</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">confir</span><span class="p">,</span> <span class="n">suspe</span><span class="p">,</span> <span class="n">reco</span></div>


<div class="viewcode-block" id="info_registration"><a class="viewcode-back" href="../modules.html#etl_functions.info_registration">[documentos]</a><span class="k">def</span> <span class="nf">info_registration</span><span class="p">(</span><span class="n">recor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtiene información sobre las hospitalizaciones y las altas, incluyendo la fecha de registro.</span>

<span class="sd">    Args:</span>
<span class="sd">        recor (list): Una lista de registros que contienen información sobre hospitalizaciones y altas.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Una tupla de cuatro listas, donde la primera lista contiene información sobre camas ocupadas,</span>
<span class="sd">               la segunda lista contiene información sobre camas ocupadas en UCI, la tercera lista contiene</span>
<span class="sd">               información sobre altas hospitalarias y la tercera lista contiene información sobre altas de</span>
<span class="sd">               atención primaria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bedh</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bedicu</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dish</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dispc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">recor</span><span class="p">:</span>
        <span class="c1"># rec.admission_reason.name si estamos con el server nuevo sino es rec.pathology.name</span>
        <span class="n">bedh</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rec</span><span class="o">.</span><span class="n">hospitalization_date</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">admission_reason</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">icu</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">bedicu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rec</span><span class="o">.</span><span class="n">hospitalization_date</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">admission_reason</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;hospitalized&#39;</span><span class="p">:</span>
            <span class="n">dish</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rec</span><span class="o">.</span><span class="n">discharge_date</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">admission_reason</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">discharge_reason</span> <span class="o">==</span> <span class="s1">&#39;Home&#39;</span><span class="p">:</span>
            <span class="n">dispc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">rec</span><span class="o">.</span><span class="n">discharge_date</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">admission_reason</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">bedh</span><span class="p">,</span> <span class="n">bedicu</span><span class="p">,</span> <span class="n">dish</span><span class="p">,</span> <span class="n">dispc</span></div>


<div class="viewcode-block" id="info_newborn"><a class="viewcode-back" href="../modules.html#etl_functions.info_newborn">[documentos]</a><span class="k">def</span> <span class="nf">info_newborn</span><span class="p">(</span><span class="n">recor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtiene información sobre los nacimientos, incluyendo la fecha de registro.</span>

<span class="sd">    Args:</span>
<span class="sd">        recor (list): Una lista de registros que contienen información sobre nacimientos.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Una tupla de tres listas, donde la primera lista contiene información sobre los embarazos a</span>
<span class="sd">               término,la segunda lista contiene información sobre los nacimientos vivos y la tercera lista</span>
<span class="sd">               contiene información sobre los nacimientos fallecidos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newb</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">newbdied</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">born</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">recor</span><span class="p">:</span>
        <span class="n">born</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">pregnancy_end_date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">pregnancy_end_result</span> <span class="o">==</span> <span class="s1">&#39;live_birth&#39;</span><span class="p">:</span>
            <span class="n">newb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">pregnancy_end_date</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newbdied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">pregnancy_end_date</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newb</span><span class="p">,</span> <span class="n">newbdied</span><span class="p">,</span> <span class="n">born</span></div>


<div class="viewcode-block" id="info_surgery"><a class="viewcode-back" href="../modules.html#etl_functions.info_surgery">[documentos]</a><span class="k">def</span> <span class="nf">info_surgery</span><span class="p">(</span><span class="n">recor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtiene información sobre las cirugías, incluyendo la fecha de registro.</span>

<span class="sd">    Args:</span>
<span class="sd">        recor (list): Una lista de registros que contienen información sobre cirugías.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Una tupla de tres listas, donde la primera lista contiene información sobre el total de cirugías,</span>
<span class="sd">               la segunda lista contiene información sobre la mortalidad en cirugías y la tercera lista contiene</span>
<span class="sd">               información sobre las cirugías exitosas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">surg</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">surgdied</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">surgalive</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">recor</span><span class="p">:</span>
        <span class="n">surg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">surgery_end_date</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">clavien_dindo</span> <span class="o">==</span> <span class="s1">&#39;grade1&#39;</span><span class="p">:</span>
            <span class="n">surgalive</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">surgery_end_date</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">surgdied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">surgery_end_date</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">surg</span><span class="p">,</span> <span class="n">surgdied</span><span class="p">,</span> <span class="n">surgalive</span></div>


<div class="viewcode-block" id="transf_dict"><a class="viewcode-back" href="../modules.html#etl_functions.transf_dict">[documentos]</a><span class="k">def</span> <span class="nf">transf_dict</span><span class="p">(</span><span class="n">surg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforma datos de cirugías en un diccionario que cuenta las fechas por enfermedad.</span>

<span class="sd">    Args:</span>
<span class="sd">        surg (list): Una lista de tuplas que contiene información sobre fechas y enfermedades.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un diccionario donde las claves son las enfermedades y los valores son diccionarios que cuentan</span>
<span class="sd">              las fechas correspondientes a cada enfermedad.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Truncar las fechas a solo el componente de la fecha (ignorando la hora)</span>
    <span class="n">fechas_sin_hora</span> <span class="o">=</span> <span class="p">[</span><span class="n">fecha</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">for</span> <span class="n">fecha</span> <span class="ow">in</span> <span class="n">surg</span><span class="p">]</span>

    <span class="c1"># Contar la frecuencia de cada fecha truncada</span>
    <span class="n">frecuencia_fechas</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">fechas_sin_hora</span><span class="p">)</span>

    <span class="c1"># Convertir el resultado a un diccionario con fechas formateadas como cadenas</span>
    <span class="n">diccionario_fechas</span> <span class="o">=</span> <span class="p">{</span><span class="n">fecha</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">):</span> <span class="n">count</span> <span class="k">for</span> <span class="n">fecha</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">frecuencia_fechas</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">return</span> <span class="n">diccionario_fechas</span></div>


<div class="viewcode-block" id="dict_payload"><a class="viewcode-back" href="../modules.html#etl_functions.dict_payload">[documentos]</a><span class="k">def</span> <span class="nf">dict_payload</span><span class="p">(</span><span class="n">morta</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforma datos de mortalidad en un diccionario que cuenta las fechas por enfermedad.</span>

<span class="sd">    Args:</span>
<span class="sd">        muertes (list): Una lista de tuplas que contiene información sobre fechas y enfermedades.</span>
<span class="sd">        lista_valores_unicos (list): Una lista de valores únicos de enfermedades.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un diccionario donde las claves son las enfermedades y los valores son diccionarios que cuentan</span>
<span class="sd">              las fechas correspondientes a cada enfermedad.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">nuevo_diccionario</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Recorrer el diccionario original</span>
    <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">valor</span> <span class="ow">in</span> <span class="n">morta</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">nuevo_diccionario</span><span class="p">[</span><span class="n">clave</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dataElement&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">valor</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">nuevo_diccionario</span></div>


<div class="viewcode-block" id="trans_dict"><a class="viewcode-back" href="../modules.html#etl_functions.trans_dict">[documentos]</a><span class="k">def</span> <span class="nf">trans_dict</span><span class="p">(</span><span class="n">muertes</span><span class="p">,</span> <span class="n">lista_valores_unicos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforma datos de muertes en un diccionario que cuenta las fechas por enfermedad.</span>

<span class="sd">    Args:</span>
<span class="sd">        muertes (list): Una lista de tuplas que contiene información sobre fechas y enfermedades.</span>
<span class="sd">        lista_valores_unicos (list): Una lista de valores únicos de enfermedades.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un diccionario donde las claves son las enfermedades y los valores son diccionarios que cuentan</span>
<span class="sd">              las fechas correspondientes a cada enfermedad.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Crear un diccionario para almacenar las fechas por enfermedad</span>
    <span class="n">fechas_por_enfermedad</span> <span class="o">=</span> <span class="p">{</span><span class="n">enf</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">enf</span> <span class="ow">in</span> <span class="n">lista_valores_unicos</span><span class="p">}</span>

    <span class="c1"># Iterar sobre los datos de muertes y agregar las fechas a la enfermedad correspondiente</span>
    <span class="k">for</span> <span class="n">fecha</span><span class="p">,</span> <span class="n">enfermedad</span> <span class="ow">in</span> <span class="n">muertes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">enf</span> <span class="ow">in</span> <span class="n">lista_valores_unicos</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">enf</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">enfermedad</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="c1"># Verificar si la fecha ya está en la lista de la enfermedad</span>
                <span class="k">if</span> <span class="n">fecha</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fechas_por_enfermedad</span><span class="p">[</span><span class="n">enf</span><span class="o">.</span><span class="n">lower</span><span class="p">()]:</span>
                    <span class="c1"># Si no está en la lista, agregarla</span>
                    <span class="n">fechas_por_enfermedad</span><span class="p">[</span><span class="n">enf</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fecha</span><span class="p">)</span>

    <span class="c1"># Crear un diccionario para almacenar el conteo final</span>
    <span class="n">diccionario_final</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Iterar sobre cada enfermedad y sus fechas correspondientes</span>
    <span class="k">for</span> <span class="n">enfermedad</span><span class="p">,</span> <span class="n">fechas</span> <span class="ow">in</span> <span class="n">fechas_por_enfermedad</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Verificar si la lista de fechas está vacía</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fechas</span><span class="p">:</span>
            <span class="c1"># Si está vacía, asignar un diccionario vacío al conteo</span>
            <span class="n">conteo_fechas</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Si no está vacía, contar las fechas usando Counter</span>
            <span class="n">conteo_fechas</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">fechas</span><span class="p">)))</span>

        <span class="c1"># Almacenar el conteo en el nuevo diccionario</span>
        <span class="n">diccionario_final</span><span class="p">[</span><span class="n">enfermedad</span><span class="p">]</span> <span class="o">=</span> <span class="n">conteo_fechas</span>
    <span class="k">return</span> <span class="n">diccionario_final</span></div>


<div class="viewcode-block" id="convertir_a_primer_dia_semana"><a class="viewcode-back" href="../modules.html#etl_functions.convertir_a_primer_dia_semana">[documentos]</a><span class="k">def</span> <span class="nf">convertir_a_primer_dia_semana</span><span class="p">(</span><span class="n">fecha</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convierte una fecha dada al primer día de la semana correspondiente en el formato &quot;YYYY-Www&quot;.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        fecha (str): La fecha en formato &quot;YYYY-MM-DD&quot; que se desea convertir.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: La fecha convertida en formato &quot;YYYY-Www&quot;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">fecha</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">inicio_semana</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">inicio_semana</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%YW%U&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="weekly"><a class="viewcode-back" href="../modules.html#etl_functions.weekly">[documentos]</a><span class="k">def</span> <span class="nf">weekly</span><span class="p">(</span><span class="n">ok</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Agrupa las fechas por semana y suma los valores correspondientes para cada enfermedad.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        ok (dict): Un diccionario que contiene información de enfermedades con fechas y valores asociados.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un diccionario modificado con las fechas agrupadas por semana y los valores sumados.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convertir las fechas a &quot;YYYY-Www&quot; y agrupar por semana</span>
    <span class="k">for</span> <span class="n">enfermedad</span><span class="p">,</span> <span class="n">fechas</span> <span class="ow">in</span> <span class="n">ok</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">fechas_convertidas</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fecha</span><span class="p">,</span> <span class="n">valor</span> <span class="ow">in</span> <span class="n">fechas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">semana</span> <span class="o">=</span> <span class="n">convertir_a_primer_dia_semana</span><span class="p">(</span><span class="n">fecha</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">semana</span> <span class="ow">in</span> <span class="n">fechas_convertidas</span><span class="p">:</span>
                <span class="n">fechas_convertidas</span><span class="p">[</span><span class="n">semana</span><span class="p">]</span> <span class="o">+=</span> <span class="n">valor</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fechas_convertidas</span><span class="p">[</span><span class="n">semana</span><span class="p">]</span> <span class="o">=</span> <span class="n">valor</span>
        <span class="n">ok</span><span class="p">[</span><span class="n">enfermedad</span><span class="p">]</span> <span class="o">=</span> <span class="n">fechas_convertidas</span>
    <span class="k">return</span> <span class="n">ok</span></div>


<div class="viewcode-block" id="to_week"><a class="viewcode-back" href="../modules.html#etl_functions.to_week">[documentos]</a><span class="k">def</span> <span class="nf">to_week</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convierte un diccionario de fechas y valores en un nuevo diccionario con fechas agrupadas por semana.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        a (dict): Un diccionario que contiene fechas como claves y valores asociados.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario con fechas agrupadas por semana en el formato &#39;YYYY-Www&#39; y valores sumados.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nuevo_diccionario</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">fecha</span><span class="p">,</span> <span class="n">valor</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Convertir la fecha a un objeto datetime</span>
        <span class="n">fecha_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">fecha</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Calcular la semana del año (ejemplo: &#39;2014W27&#39;)</span>
        <span class="n">semana_del_ano</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fecha_obj</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">W</span><span class="si">{</span><span class="n">fecha_obj</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%U&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">nuevo_diccionario</span><span class="p">[</span><span class="n">semana_del_ano</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuevo_diccionario</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">semana_del_ano</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">valor</span>
    <span class="k">return</span> <span class="n">nuevo_diccionario</span></div>


<div class="viewcode-block" id="sorteddict"><a class="viewcode-back" href="../modules.html#etl_functions.sorteddict">[documentos]</a><span class="k">def</span> <span class="nf">sorteddict</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ordena un diccionario por claves y devuelve un nuevo diccionario ordenado.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        a (dict): El diccionario que se desea ordenar.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario ordenado por claves.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span></div>


<div class="viewcode-block" id="sumar"><a class="viewcode-back" href="../modules.html#etl_functions.sumar">[documentos]</a><span class="k">def</span> <span class="nf">sumar</span><span class="p">(</span><span class="n">ejemplo</span><span class="p">,</span> <span class="n">ejemplo2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combina dos diccionarios anidados sumando las cantidades correspondientes.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        ejemplo (dict): El primer diccionario que contiene datos a sumar.</span>
<span class="sd">        ejemplo2 (dict): El segundo diccionario que contiene datos a sumar.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario que representa la suma de los datos de los dos diccionarios.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resultado</span> <span class="o">=</span> <span class="p">{</span><span class="n">clave</span><span class="p">:</span> <span class="n">dic</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">ejemplo</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Iterar sobre el segundo diccionario y sumar las cantidades</span>
    <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">ejemplo2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">clave</span> <span class="ow">in</span> <span class="n">resultado</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subclave</span><span class="p">,</span> <span class="n">cantidad</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Utilizar el método get para obtener el valor actual o 0 si la subclave no existe</span>
                <span class="n">resultado</span><span class="p">[</span><span class="n">clave</span><span class="p">][</span><span class="n">subclave</span><span class="p">]</span> <span class="o">=</span> <span class="n">resultado</span><span class="p">[</span><span class="n">clave</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subclave</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">cantidad</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Si la clave no está en el primer diccionario, agregarla con sus subclaves y cantidades</span>
            <span class="n">resultado</span><span class="p">[</span><span class="n">clave</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dic</span><span class="p">)</span>

    <span class="c1"># Mostrar el resultado</span>
    <span class="k">return</span> <span class="n">resultado</span></div>


<div class="viewcode-block" id="dividir"><a class="viewcode-back" href="../modules.html#etl_functions.dividir">[documentos]</a><span class="k">def</span> <span class="nf">dividir</span><span class="p">(</span><span class="n">ejemplo1</span><span class="p">,</span> <span class="n">ejemplo2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     Divide las cantidades de un diccionario por las cantidades correspondientes de otro diccionario.</span>

<span class="sd">     Parameters:</span>
<span class="sd">        ejemplo1 (dict): El diccionario cuyas cantidades se dividirán.</span>
<span class="sd">        ejemplo2 (dict): El diccionario cuyas cantidades se utilizarán como divisor.</span>

<span class="sd">     Returns:</span>
<span class="sd">        dict: Un nuevo diccionario que representa el resultado de la división de cantidades.</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="c1"># Crear una copia del primer diccionario para no modificar el original</span>
    <span class="n">resultado</span> <span class="o">=</span> <span class="p">{</span><span class="n">clave</span><span class="p">:</span> <span class="n">dic</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">ejemplo2</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Iterar sobre el segundo diccionario y dividir las cantidades</span>
    <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">ejemplo1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">clave</span> <span class="ow">in</span> <span class="n">resultado</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subclave</span><span class="p">,</span> <span class="n">cantidad</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Utilizar el método get para obtener el valor actual o 1 si la subclave no existe</span>
                <span class="n">divisor</span> <span class="o">=</span> <span class="n">resultado</span><span class="p">[</span><span class="n">clave</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subclave</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">resultado</span><span class="p">[</span><span class="n">clave</span><span class="p">][</span><span class="n">subclave</span><span class="p">]</span> <span class="o">=</span> <span class="n">cantidad</span> <span class="o">/</span> <span class="n">divisor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Si la clave no está en el primer diccionario, agregarla con sus subclaves y cantidades</span>
            <span class="n">resultado</span><span class="p">[</span><span class="n">clave</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">subclave</span><span class="p">:</span> <span class="n">cantidad</span> <span class="k">for</span> <span class="n">subclave</span><span class="p">,</span> <span class="n">cantidad</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Mostrar el resultado</span>
    <span class="k">return</span> <span class="n">resultado</span></div>


<div class="viewcode-block" id="porcentaje"><a class="viewcode-back" href="../modules.html#etl_functions.porcentaje">[documentos]</a><span class="k">def</span> <span class="nf">porcentaje</span><span class="p">(</span><span class="n">ejemplo1</span><span class="p">,</span> <span class="n">ejemplo2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula el porcentaje de las cantidades de un diccionario en relación con las cantidades de otro diccionario.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        ejemplo1 (dict): El diccionario cuyas cantidades se utilizarán como numerador para calcular el porcentaje.</span>
<span class="sd">        ejemplo2 (dict): El diccionario cuyas cantidades se utilizarán como denominador para calcular el porcentaje.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario que representa el resultado del cálculo de porcentajes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Crear una copia del primer diccionario para no modificar el original</span>
    <span class="n">resultado</span> <span class="o">=</span> <span class="p">{</span><span class="n">clave</span><span class="p">:</span> <span class="n">dic</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">ejemplo2</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Iterar sobre el segundo diccionario y dividir las cantidades</span>
    <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">ejemplo1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">clave</span> <span class="ow">in</span> <span class="n">resultado</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subclave</span><span class="p">,</span> <span class="n">cantidad</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Utilizar el método get para obtener el valor actual o 1 si la subclave no existe</span>
                <span class="n">divisor</span> <span class="o">=</span> <span class="n">resultado</span><span class="p">[</span><span class="n">clave</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subclave</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">resultado</span><span class="p">[</span><span class="n">clave</span><span class="p">][</span><span class="n">subclave</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cantidad</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Si la clave no está en el primer diccionario, agregarla con sus subclaves y cantidades</span>
            <span class="n">resultado</span><span class="p">[</span><span class="n">clave</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">subclave</span><span class="p">:</span> <span class="n">cantidad</span> <span class="k">for</span> <span class="n">subclave</span><span class="p">,</span> <span class="n">cantidad</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Mostrar el resultado</span>
    <span class="k">return</span> <span class="n">resultado</span></div>


<div class="viewcode-block" id="res_ind"><a class="viewcode-back" href="../modules.html#etl_functions.res_ind">[documentos]</a><span class="k">def</span> <span class="nf">res_ind</span><span class="p">(</span><span class="n">dic1</span><span class="p">,</span> <span class="n">dic2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resta los valores de dos diccionarios para las fechas comunes y agrega las fechas exclusivas de cada diccionario.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dic1 (dict): Primer diccionario que contiene fechas como claves y valores asociados.</span>
<span class="sd">        dic2 (dict): Segundo diccionario que contiene fechas como claves y valores asociados.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario que representa la suma de valores para las fechas comunes y las fechas exclusivas.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Crear un nuevo diccionario para almacenar la suma de los valores por fecha</span>
    <span class="n">result_dict_solv</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Iterar sobre las fechas comunes en ambos diccionarios</span>
    <span class="n">common_dates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">+</span> <span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>

    <span class="c1"># Agregar las fechas que solo están en dic1</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>

    <span class="c1"># Agregar las fechas que solo están en dic2</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result_dict_solv</span></div>


<div class="viewcode-block" id="three_dicts"><a class="viewcode-back" href="../modules.html#etl_functions.three_dicts">[documentos]</a><span class="k">def</span> <span class="nf">three_dicts</span><span class="p">(</span><span class="n">dic1</span><span class="p">,</span> <span class="n">dic2</span><span class="p">,</span> <span class="n">dic3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Realiza operaciones de resta entre tres diccionarios para fechas comunes y agrega fechas exclusivas.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dic1 (dict): Primer diccionario que contiene fechas como claves y valores asociados.</span>
<span class="sd">        dic2 (dict): Segundo diccionario que contiene fechas como claves y valores asociados.</span>
<span class="sd">        dic3 (dict): Tercer diccionario que contiene fechas como claves y valores asociados.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario que representa la resta de los valores para fechas comunes y las fechas exclusivas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Crear un nuevo diccionario para almacenar la resta de los valores por fecha</span>
    <span class="n">ActiveCases</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Obtener las fechas comunes entre los tres diccionarios</span>
    <span class="n">common_dates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic3</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># Iterar sobre las fechas comunes y restar los valores correspondientes de dic2 y dic3 a dic1</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">ActiveCases</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">-</span> <span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">-</span> <span class="n">dic3</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>

    <span class="c1"># Agregar las fechas que están en dic1 pero no en dic2 o dic3</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">ActiveCases</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>

    <span class="c1"># Agregar las fechas que están en dic2 pero no en dic1 o dic3</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">ActiveCases</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>

    <span class="c1"># Agregar las fechas que están en dic3 pero no en dic1 o dic2</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic3</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">ActiveCases</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">dic3</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>  <span class="c1"># Restar los valores de dic3</span>

    <span class="k">return</span> <span class="n">ActiveCases</span></div>


<div class="viewcode-block" id="percent_ind"><a class="viewcode-back" href="../modules.html#etl_functions.percent_ind">[documentos]</a><span class="k">def</span> <span class="nf">percent_ind</span><span class="p">(</span><span class="n">dic1</span><span class="p">,</span> <span class="n">dic2</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula el porcentaje de los valores de un diccionario en relación con los valores correspondientes de otro diccionario.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dic1 (dict): El diccionario cuyas cantidades se utilizarán como numerador para calcular el porcentaje.</span>
<span class="sd">        dic2 (dict): El diccionario cuyas cantidades se utilizarán como denominador para calcular el porcentaje.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario que representa el resultado del cálculo de porcentajes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Crear un nuevo diccionario para almacenar la suma de los valores por fecha</span>
    <span class="n">result_dict_solv</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Iterar sobre las fechas comunes en ambos diccionarios</span>
    <span class="n">common_dates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">/</span> <span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Agregar las fechas que solo están en dic1</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>

    <span class="c1"># Agregar las fechas que solo están en dic2</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result_dict_solv</span></div>


<div class="viewcode-block" id="percentmil_ind"><a class="viewcode-back" href="../modules.html#etl_functions.percentmil_ind">[documentos]</a><span class="k">def</span> <span class="nf">percentmil_ind</span><span class="p">(</span><span class="n">dic1</span><span class="p">,</span> <span class="n">dic2</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula el porcentaje de los valores de un diccionario en relación con los valores correspondientes de otro diccionario,</span>
<span class="sd">    multiplicando el resultado por 1000.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dic1 (dict): El diccionario cuyas cantidades se utilizarán como numerador para calcular el porcentaje.</span>
<span class="sd">        dic2 (dict): El diccionario cuyas cantidades se utilizarán como denominador para calcular el porcentaje.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario que representa el resultado del cálculo de porcentajes multiplicado por 1000.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Crear un nuevo diccionario para almacenar la suma de los valores por fecha</span>
    <span class="n">result_dict_solv</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Iterar sobre las fechas comunes en ambos diccionarios</span>
    <span class="n">common_dates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">/</span> <span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">])</span> <span class="o">*</span> <span class="mi">1000</span>

    <span class="c1"># Agregar las fechas que solo están en dic1</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>

    <span class="c1"># Agregar las fechas que solo están en dic2</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result_dict_solv</span></div>


<div class="viewcode-block" id="div_ind"><a class="viewcode-back" href="../modules.html#etl_functions.div_ind">[documentos]</a><span class="k">def</span> <span class="nf">div_ind</span><span class="p">(</span><span class="n">dic1</span><span class="p">,</span> <span class="n">dic2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Realiza la operación de división entre los valores de dos diccionarios para fechas comunes y agrega fechas exclusivas.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dic1 (dict): El diccionario cuyas cantidades se utilizarán como numerador para la operación de división.</span>
<span class="sd">        dic2 (dict): El diccionario cuyas cantidades se utilizarán como denominador para la operación de división.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario que representa el resultado de la división para fechas comunes y las fechas exclusivas.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Crear un nuevo diccionario para almacenar la suma de los valores por fecha</span>
    <span class="n">result_dict_solv</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Iterar sobre las fechas comunes en ambos diccionarios</span>
    <span class="n">common_dates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">/</span> <span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">])</span>

    <span class="c1"># Agregar las fechas que solo están en dic1</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic1</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>

    <span class="c1"># Agregar las fechas que solo están en dic2</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">dic2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">common_dates</span><span class="p">:</span>
        <span class="n">result_dict_solv</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">dic2</span><span class="p">[</span><span class="n">date</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result_dict_solv</span></div>


<div class="viewcode-block" id="sortedict"><a class="viewcode-back" href="../modules.html#etl_functions.sortedict">[documentos]</a><span class="k">def</span> <span class="nf">sortedict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ordena las fechas dentro de cada enfermedad de un diccionario.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (dict): El diccionario que contiene enfermedades como claves y diccionarios de fechas y cantidades asociadas.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario con las fechas ordenadas para cada enfermedad.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">disease</span><span class="p">,</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">data</span><span class="p">[</span><span class="n">disease</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">dates</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="accumulated"><a class="viewcode-back" href="../modules.html#etl_functions.accumulated">[documentos]</a><span class="k">def</span> <span class="nf">accumulated</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula el total acumulado de cantidades para cada fecha dentro de cada enfermedad en un diccionario.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data (dict): El diccionario que contiene enfermedades como claves y diccionarios de fechas y cantidades asociadas.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario con los totales acumulados para cada fecha dentro de cada enfermedad.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">disease</span><span class="p">,</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cumulative_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">dates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cumulative_count</span> <span class="o">+=</span> <span class="n">count</span>
            <span class="n">data</span><span class="p">[</span><span class="n">disease</span><span class="p">][</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative_count</span>
    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="new_dict"><a class="viewcode-back" href="../modules.html#etl_functions.new_dict">[documentos]</a><span class="k">def</span> <span class="nf">new_dict</span><span class="p">(</span><span class="n">dicc_act</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforma un diccionario de conteo en un nuevo diccionario con un formato específico.</span>

<span class="sd">    Args:</span>
<span class="sd">        dicc_act (dict): Un diccionario que contiene información de conteo.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Un nuevo diccionario con un formato particular.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nuevo_diccionario</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Recorrer el diccionario original</span>
    <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">valor</span> <span class="ow">in</span> <span class="n">dicc_act</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">fecha</span><span class="p">,</span> <span class="n">cantidad</span> <span class="ow">in</span> <span class="n">valor</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nuevo_diccionario</span><span class="p">[</span><span class="n">fecha</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dataElement&#39;</span><span class="p">:</span> <span class="n">clave</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cantidad</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">nuevo_diccionario</span></div>


<div class="viewcode-block" id="new_dict_dupli"><a class="viewcode-back" href="../modules.html#etl_functions.new_dict_dupli">[documentos]</a><span class="k">def</span> <span class="nf">new_dict_dupli</span><span class="p">(</span><span class="n">dicc_act</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convierte un diccionario de datos en un nuevo formato específico, agrupando por fechas y enfermedades.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dicc_act (dict): El diccionario original que contiene enfermedades como claves y diccionarios de fechas y cantidades asociadas.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Una lista de diccionarios en un formato específico, agrupando por fechas y enfermedades.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nuevo_diccionario</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Recorrer el diccionario original</span>
    <span class="k">for</span> <span class="n">enfermedad</span><span class="p">,</span> <span class="n">fechas</span> <span class="ow">in</span> <span class="n">dicc_act</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">fecha</span><span class="p">,</span> <span class="n">cantidad</span> <span class="ow">in</span> <span class="n">fechas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Crear un nuevo diccionario con la estructura deseada</span>
            <span class="k">if</span> <span class="n">cantidad</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Asegurarse de agregar solo las fechas con cantidad mayor a 0</span>
                <span class="n">clave</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">enfermedad</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">fecha</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nuevo_diccionario</span><span class="p">:</span>
                    <span class="n">nuevo_diccionario</span><span class="p">[</span><span class="n">fecha</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;dataElement&#39;</span><span class="p">:</span> <span class="n">enfermedad</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cantidad</span><span class="p">}]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nuevo_diccionario</span><span class="p">[</span><span class="n">fecha</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;dataElement&#39;</span><span class="p">:</span> <span class="n">enfermedad</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cantidad</span><span class="p">})</span>

    <span class="c1"># Convertir el diccionario final a una lista de diccionarios</span>
    <span class="n">lista_final</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fecha</span><span class="p">,</span> <span class="n">registros</span> <span class="ow">in</span> <span class="n">nuevo_diccionario</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">registro</span> <span class="ow">in</span> <span class="n">registros</span><span class="p">:</span>
            <span class="n">lista_final</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">fecha</span><span class="p">:</span> <span class="p">[</span><span class="n">registro</span><span class="p">]})</span>

    <span class="k">return</span> <span class="n">lista_final</span></div>


<div class="viewcode-block" id="dict_in_list"><a class="viewcode-back" href="../modules.html#etl_functions.dict_in_list">[documentos]</a><span class="k">def</span> <span class="nf">dict_in_list</span><span class="p">(</span><span class="n">nuevo_diccionario</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convierte un diccionario en una lista.</span>

<span class="sd">    Args:</span>
<span class="sd">        nuevo_diccionario (dict): Un diccionario que se desea convertir en una lista.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Una lista que contiene el diccionario como su único elemento.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lista</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">lista</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nuevo_diccionario</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lista</span></div>


<div class="viewcode-block" id="dict_to_list"><a class="viewcode-back" href="../modules.html#etl_functions.dict_to_list">[documentos]</a><span class="k">def</span> <span class="nf">dict_to_list</span><span class="p">(</span><span class="n">list_illnes</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convierte un diccionario de datos en un nuevo formato específico, agrupando por fechas y enfermedades.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        list_illnes (list): Lista de enfermedades.</span>
<span class="sd">        vector (dict): Diccionario que asocia enfermedades con sus valores.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Una lista de diccionarios en un formato específico, agrupando por fechas y enfermedades.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sector</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">list_illnes</span><span class="p">,</span> <span class="n">vector</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">new_dict1</span> <span class="o">=</span> <span class="n">new_dict_dupli</span><span class="p">(</span><span class="n">sector</span><span class="p">)</span>
    <span class="c1"># listdea1 = dict_in_list(new_dict1)</span>
    <span class="k">return</span> <span class="n">new_dict1</span></div>


<div class="viewcode-block" id="new_dict4"><a class="viewcode-back" href="../modules.html#etl_functions.new_dict4">[documentos]</a><span class="k">def</span> <span class="nf">new_dict4</span><span class="p">(</span><span class="n">dicc_act</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convierte un diccionario de datos en un nuevo formato específico, agrupando por fechas y enfermedades.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        dicc_act (dict): El diccionario original que contiene enfermedades como claves y diccionarios de fechas y cantidades asociadas.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Una lista de diccionarios en un formato específico, agrupando por fechas y enfermedades.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nuevo_diccionario</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Recorrer el diccionario original</span>
    <span class="k">for</span> <span class="n">enfermedad</span><span class="p">,</span> <span class="n">fechas</span> <span class="ow">in</span> <span class="n">dicc_act</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">fecha</span><span class="p">,</span> <span class="n">cantidad</span> <span class="ow">in</span> <span class="n">fechas</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Crear un nuevo diccionario con la estructura deseada</span>
            <span class="k">if</span> <span class="n">cantidad</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Asegurarse de agregar solo las fechas con cantidad mayor a 0</span>
                <span class="n">clave</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fecha</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">enfermedad</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">fecha</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nuevo_diccionario</span><span class="p">:</span>
                    <span class="n">nuevo_diccionario</span><span class="p">[</span><span class="n">fecha</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;dataElement&#39;</span><span class="p">:</span> <span class="n">enfermedad</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cantidad</span><span class="p">}]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">nuevo_diccionario</span><span class="p">[</span><span class="n">fecha</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;dataElement&#39;</span><span class="p">:</span> <span class="n">enfermedad</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">cantidad</span><span class="p">})</span>

    <span class="c1"># Convertir el diccionario final a una lista de diccionarios</span>
    <span class="n">lista_final</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fecha</span><span class="p">,</span> <span class="n">registros</span> <span class="ow">in</span> <span class="n">nuevo_diccionario</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">registro</span> <span class="ow">in</span> <span class="n">registros</span><span class="p">:</span>
            <span class="n">lista_final</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">fecha</span><span class="p">:</span> <span class="p">[</span><span class="n">registro</span><span class="p">]})</span>

    <span class="k">return</span> <span class="n">lista_final</span></div>


<div class="viewcode-block" id="dictio_to_list"><a class="viewcode-back" href="../modules.html#etl_functions.dictio_to_list">[documentos]</a><span class="k">def</span> <span class="nf">dictio_to_list</span><span class="p">(</span><span class="n">list_illnes</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convierte un diccionario de datos en un formato específico, agrupando por fechas y enfermedades.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        list_illnes (list): Lista de enfermedades.</span>
<span class="sd">        vector (dict): Diccionario que asocia enfermedades con sus valores.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: Una lista de listas de diccionarios en un formato específico, agrupando por fechas y enfermedades.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sector</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">list_illnes</span><span class="p">,</span> <span class="n">vector</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">new_dict1</span> <span class="o">=</span> <span class="n">new_dict4</span><span class="p">(</span><span class="n">sector</span><span class="p">)</span>
    <span class="n">lista_transformada</span> <span class="o">=</span> <span class="p">[{</span><span class="n">clave</span><span class="p">:</span> <span class="n">diccionario</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span> <span class="k">for</span> <span class="n">diccionario_con_lista</span> <span class="ow">in</span> <span class="n">new_dict1</span>
                          <span class="k">for</span> <span class="n">clave</span><span class="p">,</span> <span class="n">diccionario</span> <span class="ow">in</span> <span class="n">diccionario_con_lista</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">listas_listas</span> <span class="o">=</span> <span class="p">[[</span><span class="n">elementos</span><span class="p">]</span> <span class="k">for</span> <span class="n">elementos</span> <span class="ow">in</span> <span class="n">lista_transformada</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">listas_listas</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor 2023, Edosoft.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>